<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>my app</title>
</head>
<body>
    <h1>Notes</h1>
    
    <!-- Create New Note Section -->
    <div>
        <h3>Create New Note</h3>
        <input type="text" id="new-note-title" placeholder="Note title">
        <textarea id="new-note-content" placeholder="Note content"></textarea>
        <button onclick="createNote()">Create Note</button>
    </div>
    
    <!-- Notes List Section -->
    <div>
        <h3>Your Notes</h3>
        <button onclick="loadNotes()">Refresh Notes</button>
        <div id="notes-list"></div>
    </div>

    <script>
        // Load notes when page loads
        document.addEventListener('DOMContentLoaded', loadNotes)

        // Function to load and display all notes
        async function loadNotes() {
            try {
                const allNotes = await window.electronAPI.getAllNotes()
                displayNotes(allNotes)
            } catch (error) {
                console.error('Error loading notes:', error)
            }
        }

        // Function to display notes
        function displayNotes(notes) {
            const notesList = document.getElementById('notes-list')
            
            if (notes.length === 0) {
                notesList.innerHTML = '<p>No notes yet. Create your first note above!</p>'
                return
            }
            
            // Create HTML for each note
            let html = ''
            for (let note of notes) {
                html += createNoteHTML(note)
            }
            
            // Put the HTML on the page
            notesList.innerHTML = html
        }

        // Function to create HTML for a single note
        function createNoteHTML(note) {
            return `
                <div>
                    <div>
                        <h4>${escapeHtml(note.title)}</h4>
                        <p>${escapeHtml(note.content).replace(/\n/g, '<br>')}</p>
                        <small>Created: ${new Date(note.createdAt).toLocaleString()}</small>
                        <div>
                            <button onclick="startEdit(${note.id})">Edit</button>
                            <button onclick="deleteNote(${note.id})">Delete</button>
                        </div>
                    </div>
                    
                    <div id="edit-form-${note.id}" style="display: none;">
                        <input type="text" id="edit-title-${note.id}" value="${escapeHtml(note.title)}" placeholder="Note title">
                        <textarea id="edit-content-${note.id}" placeholder="Note content">${escapeHtml(note.content)}</textarea>
                        <button onclick="saveEdit(${note.id})">Save</button>
                        <button onclick="cancelEdit(${note.id})">Cancel</button>
                    </div>
                </div>
            `
        }

        // Function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div')
            div.textContent = text
            return div.innerHTML
        }

        // Function to create a note
        async function createNote() {
            const title = document.getElementById('new-note-title').value
            const content = document.getElementById('new-note-content').value
            
            if (!title.trim() || !content.trim()) {
                alert('Please enter both title and content')
                return
            }
            
            try {
                await window.electronAPI.createNote(title, content)
                
                // Clear the input fields
                document.getElementById('new-note-title').value = ''
                document.getElementById('new-note-content').value = ''
                
                // Refresh the notes list
                await loadNotes()
            } catch (error) {
                console.error('Error creating note:', error)
                alert('Error creating note')
            }
        }

        // Function to start editing
        function startEdit(noteId) {
            const editForm = document.getElementById(`edit-form-${noteId}`)
            editForm.style.display = 'block'
        }

        // Function to save edit
        async function saveEdit(noteId) {
            const title = document.getElementById(`edit-title-${noteId}`).value
            const content = document.getElementById(`edit-content-${noteId}`).value
            
            if (!title.trim() || !content.trim()) {
                alert('Please enter both title and content')
                return
            }
            
            try {
                await window.electronAPI.editNote(noteId, title, content)
                await loadNotes()
            } catch (error) {
                console.error('Error updating note:', error)
                alert('Error updating note')
            }
        }

        // Function to cancel edit
        function cancelEdit(noteId) {
            const editForm = document.getElementById(`edit-form-${noteId}`)
            editForm.style.display = 'none'
        }

        // Function to delete note
        async function deleteNote(noteId) {
            if (!confirm('Are you sure you want to delete this note?')) {
                return
            }
            
            try {
                await window.electronAPI.deleteNote(noteId)
                await loadNotes()
            } catch (error) {
                console.error('Error deleting note:', error)
                alert('Error deleting note')
            }
        }

        // Allow creating note with Enter key
        document.getElementById('new-note-title').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                createNote()
            }
        })

        // Allow creating note with Ctrl+Enter in content
        document.getElementById('new-note-content').addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                createNote()
            }
        })
    </script>
</body>
</html>